'use strict';

const mqtt = require('mqtt');

const NodeMQTTEmitter = require('./node-mqtt-emitter');
const ContextStore = require('./context-store');
const App = require('./app');


class ThunderSDK {

  constructor(mqttBrokerAddress, services) {
    this.mqttClient = mqtt.connect(mqttBrokerAddress);
    this.mqttEmitter = NodeMQTTEmitter(this.mqttClient);
    this.contextStore = new ContextStore();
    this.defaultTaskConfig = {
      'audioplay': require('../tasks/audioplay'),
      'audiorec': require('../tasks/audiorec'),
      'speech2text': require('../tasks/speech2text'),
      'text2speech': require('../tasks/text2speech')
    };
  }

  app(appId) {
    return new App(appId, this.contextStore, this.mqttEmitter, this.defaultTaskConfig);
  }
}

module.exports = ThunderSDK;
