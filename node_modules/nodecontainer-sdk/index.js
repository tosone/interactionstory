// Config

'use strict';

const fs = require('fs');

const mqtt = require('mqtt');
const redis = require('redis');
const Emitter = require("events").EventEmitter;

const redis1 = redis.createClient({ 'host': 'localhost', 'db': 1 });
const redis3 = redis.createClient({ 'host': 'localhost', 'db': 3 });
const redis8 = redis.createClient({ 'host': 'localhost', 'db': 8 });

let mqttClient = mqtt.connect('mqtt://localhost:1883');

mqttClient.on('connect', () => { mqttClient.subscribe('#'); });

const macLocation = "/sys/class/net/wlan0/address";
let macAddress = null;
if (fs.existsSync(macLocation)) { macAddress = fs.readFileSync(macLocation).toString().trim().toUpperCase(); }

const event = new Emitter();
event.setMaxListeners(50);

const bbcloudBaseUrl = process.env.bbcloudBaseUrl;
const aliyunAccessKeyId = process.env.aliyunAccessKeyId;
const aliyunAccessKeySecret = process.env.aliyunAccessKeySecret;
const ossEndpoint = process.env.ossEndpoint;

module.exports = {
  macAddress,
  redis1,
  redis3,
  redis8,
  event,
  mqtt: mqttClient,
  bbcloudBaseUrl,
  aliyunAccessKeyId,
  aliyunAccessKeySecret,
  ossEndpoint
};
